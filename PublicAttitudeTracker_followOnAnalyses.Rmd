---
title: "Follow on analysis of Kantar Public Attitude Tracker datat 2021"
author: "K L Purves"
date: '`r format(Sys.time(), "%d %B, %Y")`'

output:
  html_document:
    keep_md: true # save images
    self_contained: true
    code_folding: hide
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: cerulean


html_notebook:
  theme: cerulean
toc: yes
---


# set up

## Environment
```{r, include=FALSE}
# clear global environment
remove(list = ls())
```


```{r setup, warning=FALSE,echo=FALSE}

# source in all functions in the function library folder
files.sources = paste0("../functions/",list.files("../functions"))
sapply(files.sources, source)


knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)

# this chunk installs any required packages if you dont already have them in your local library. 
# List of required package names

packages <- c("ggplot2","gtsummary","kableExtra", 
              "purrr", "skimr","readr",
              "readxl","psych",
              "haven", "expss",
              "dplyr", "tidyr")

# apply function to install and load functions as needed. Prints version to screen.
# see function library for code (../functions)
load_packages(packages)

```


# read in raw data

```{r read in raw data}
#import data
df <- read_sav("/Users/kirstinpurves/Library/CloudStorage/OneDrive-SharedLibraries-OurFutureHealth/Main Share - Documents/Our Future Health - Project Team/Behavioural Science/Public attitudes survey 2021/Raw data DO NOT EDIT/262323129-40C_Our Future Health_Dataset_FINAL.sav")
```

skim the data for missingness, completeness and unique values

```{r quick view of file structure and contents, warning=FALSE}

skim(df)

```

Turn character variables into factors using labels instead of values. Use is.labelled function from custom function library

```{r convert to labelled factor}

factor_df <- df %>%
  mutate_if(is.labelled,as_factor)
          
```

Skim new factor labelled data. We can use this for anything where labels are useful. Retain original df for dummy coding.

```{r skim factor df}

skim(factor_df)
```
